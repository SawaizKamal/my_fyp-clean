# üöÄ Render Deployment Guide - Production Ready

This guide will help you deploy your application to Render with optimal configuration.

## üìã Pre-Deployment Checklist

Before deploying, ensure you have:
- [ ] GitHub repository connected to Render
- [ ] OpenAI API key (required)
- [ ] YouTube API key (optional but recommended)
- [ ] Render account (free tier works for testing)

## üîß Step 1: Render Configuration

### 1.1 Connect Repository

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click **"New +"** ‚Üí **"Blueprint"**
3. Connect your GitHub account
4. Select repository: `your-username/my_fyp-clean`
5. Render will automatically detect `render.yaml`

### 1.2 Service Configuration

The `render.yaml` file is already configured with:
- **Service Type**: Web Service
- **Plan**: Standard (2GB RAM, 1 CPU) - Recommended for production
- **Python Version**: 3.10.13
- **Node Version**: 20.0.0
- **Build Command**: `python build.py`
- **Start Command**: `cd backend && python -m uvicorn main:app --host 0.0.0.0 --port $PORT --workers 1`

### 1.3 Plan Selection

| Plan | RAM | CPU | Cost | Best For |
|------|-----|-----|------|----------|
| **Starter** | 512 MB | 0.5 CPU | $7/month | Development/Testing |
| **Standard** | 2 GB | 1 CPU | $25/month | **Production (Recommended)** |
| **Standard Plus** | 4 GB | 2 CPU | $85/month | High Load Production |

**Recommendation**: Start with **Standard** plan for production.

## üîê Step 2: Environment Variables

Configure these in Render Dashboard ‚Üí Your Service ‚Üí Environment:

### Required Variables

```bash
OPENAI_API_KEY=sk-...                    # Your OpenAI API key (required)
SECRET_KEY=...                            # Auto-generated by Render
DATABASE_URL=...                          # Auto-configured from database
ENVIRONMENT=production                    # Set to production
```

### Optional but Recommended

```bash
YOUTUBE_API_KEY=...                       # YouTube Data API v3 key
ALLOWED_ORIGINS=https://your-app.onrender.com  # Your app URL (comma-separated)
```

### How to Set Environment Variables

1. In Render Dashboard, go to your service
2. Click **"Environment"** tab
3. Click **"Add Environment Variable"**
4. Add each variable:
   - `OPENAI_API_KEY`: Get from https://platform.openai.com/api-keys
   - `YOUTUBE_API_KEY`: Get from https://console.cloud.google.com
   - `ALLOWED_ORIGINS`: Your Render app URL (e.g., `https://my-app.onrender.com`)
   - `ENVIRONMENT`: Set to `production`

**Note**: `SECRET_KEY` and `DATABASE_URL` are automatically generated/configured by Render.

## üóÑÔ∏è Step 3: Database Setup

The `render.yaml` automatically creates a PostgreSQL database:
- **Name**: `fullstack-db`
- **Plan**: Free (upgrade to Starter $7/month for better performance)
- **Connection**: Automatically configured via `DATABASE_URL`

The application will automatically:
- Create tables on first startup
- Handle database migrations
- Use PostgreSQL on Render, SQLite locally

## üöÄ Step 4: Deploy

### 4.1 Initial Deployment

1. Render will automatically:
   - Clone your repository
   - Run `python build.py` (builds frontend + installs backend dependencies)
   - Start the service

2. **First build takes ~10-15 minutes** (installs dependencies, builds frontend)

3. Monitor the build logs in Render Dashboard

### 4.2 Verify Deployment

Once deployed, check:

1. **Health Endpoint**: `https://your-app.onrender.com/api/health`
   - Should return: `{"status": "ok", "database": "connected", "model": "gpt-4o"}`

2. **Frontend**: `https://your-app.onrender.com`
   - Should load your React frontend

3. **API Endpoints**: Test a few endpoints to ensure they work

## üìä Step 5: Monitor & Optimize

### 5.1 Monitor Resources

In Render Dashboard, monitor:
- **Memory Usage**: Should stay below 80% (Whisper model uses ~200MB)
- **CPU Usage**: Spikes during video processing are normal
- **Response Times**: Should be < 2s for most endpoints

### 5.2 Common Issues & Solutions

#### Issue: Build Fails
**Solution**: 
- Check build logs for errors
- Verify all environment variables are set
- Ensure `render.yaml` syntax is correct

#### Issue: Service Won't Start
**Solution**:
- Check logs for startup errors
- Verify `OPENAI_API_KEY` is set correctly
- Check if port is correctly set to `$PORT`

#### Issue: Out of Memory
**Solution**:
- Upgrade to Standard Plus plan (4GB RAM)
- Or optimize Whisper model (use "tiny" instead of "base")

#### Issue: Video Processing Fails
**Solution**:
- Check if ffmpeg is available (should be on Render by default)
- Verify video download is successful
- Check OpenAI API key is valid

#### Issue: Database Connection Errors
**Solution**:
- Verify `DATABASE_URL` is set (auto-configured)
- Check database is running in Render dashboard
- Ensure database plan is active

## üîí Step 6: Security Checklist

- [ ] `SECRET_KEY` is set (auto-generated by Render)
- [ ] `ALLOWED_ORIGINS` is configured (not `*`)
- [ ] `ENVIRONMENT=production` is set
- [ ] API keys are stored in environment variables (not in code)
- [ ] CORS is properly configured

## üìù Step 7: Post-Deployment

### 7.1 Test All Features

- [ ] User registration
- [ ] User login
- [ ] Video search (if YouTube API key is set)
- [ ] Chat assistant
- [ ] Video transcription
- [ ] Code analysis endpoints

### 7.2 Set Up Monitoring

Consider setting up:
- **Uptime Monitoring**: Render provides basic monitoring
- **Error Tracking**: Consider Sentry or similar
- **API Usage Monitoring**: Monitor OpenAI API usage

## üí∞ Cost Estimation

### Monthly Costs (Production)

| Service | Plan | Cost |
|---------|------|------|
| **Web Service** | Standard (2GB RAM) | $25/month |
| **Database** | Starter | $7/month |
| **Total** | | **$32/month** |

### Additional Costs

- **OpenAI API**: Pay-per-use (monitor in OpenAI dashboard)
- **YouTube API**: Free tier available (10,000 units/day)

## üéØ Performance Tips

1. **Whisper Model**: Already cached (loads once, reused)
2. **Video Processing**: Runs in background tasks
3. **Database**: Connection pooling handled by SQLAlchemy
4. **Static Files**: Served efficiently by FastAPI

## üîÑ Updating Your App

To update your app:
1. Push changes to GitHub
2. Render automatically detects changes
3. Triggers new deployment
4. Monitor build logs

## üìö Additional Resources

- [Render Documentation](https://render.com/docs)
- [OpenAI API Keys](https://platform.openai.com/api-keys)
- [YouTube Data API](https://console.cloud.google.com)
- [FastAPI Deployment](https://fastapi.tiangolo.com/deployment/)

## ‚ö†Ô∏è Important Notes

### Video Storage
- Videos are stored in `backend/data/` (ephemeral on Render)
- **Data is lost on redeploy** - Consider using:
  - AWS S3
  - Google Cloud Storage
  - Cloudinary
  - Or other cloud storage

### Resource Limits
- **Free Tier**: 512MB RAM, 0.5 CPU (not recommended for production)
- **Standard**: 2GB RAM, 1 CPU (recommended for production)
- Video processing is CPU/memory intensive

### Build Time
- First build: ~10-15 minutes
- Subsequent builds: ~5-8 minutes

## ‚úÖ Deployment Complete!

Your app should now be live at: `https://your-app.onrender.com`

If you encounter any issues, check:
1. Build logs in Render Dashboard
2. Service logs for runtime errors
3. Environment variables are correctly set
4. Database is running and connected

---

**Need Help?** Check the troubleshooting section or Render's support documentation.

